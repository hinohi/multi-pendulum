\documentclass[uplatex]{jsarticle}

\usepackage[japanese]{babel}

% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{physics}
\usepackage{url}
\usepackage{siunitx}

\title{多重振り子}
\author{中山 大樹}

\begin{document}
\maketitle

\section{2次元単振り子をラグランジュ未定乗数法で解く}

質量$m$[\si{kg}]の質点が伸び縮みしない剛体棒で繋がれている状況を考える。
重力の向きを$-y$方向にとり、重力加速度を$g$とする。

振り子の根本の座標を$(x_0(t), y_0(t))$、質点の座標を$(x_1(t), y_1(t))$とする。

拘束条件は
\begin{align}
    \qty(x_1 - x_0)^2 + \qty(y_1 - y_0)^2 = l^2  \label{2d_single_cons}
\end{align}
ただし$l$[\si{m}]は剛体棒の長さ。

拘束条件込みのラグランジアンは\cite{a}を参考にすると
\begin{align}
    L = \frac{1}{2} m \qty(\dot{x}_1^2 + \dot{y}_1^2) - mgy_1
        - \lambda \qty(\qty(x_1 - x_0)^2 + \qty(y_1 - y_0)^2 - l^2)
\end{align}
となる。
オイラーラグランジュの運動方程式を
\begin{align}
    \dv{}{t}\pdv{L}{\dot{q}} - \pdv{L}{q} = 0
\end{align}
より求めておくと
\begin{align}
\begin{cases}
    m \ddot{x}_1 = -2\lambda\qty(x_1 - x_0) \\
    m \ddot{y}_1 = -2\lambda\qty(y_1 - y_0) - mg
\end{cases}
\label{2d_single_eom}
\end{align}
となる。

$x_0(t)$と$y_0(t)$は外から与えられる2階時間微分可能な関数である。

\eqref{2d_single_cons}を時間微分する
\begin{align}
    &\qty(x_1 - x_0)^2 + \qty(y_1 - y_0)^2 = l^2 \tag{\ref{2d_single_cons}} \\
    \xrightarrow{\dv{}{t}}&
    \qty(x_1 - x_0) \qty(\dot{x}_1 - \dot{x}_0) + \qty(y_1 - y_0) \qty(\dot{y}_1 - \dot{y}_0) = 0 \\
    \xrightarrow{\dv{}{t}}&
    \qty(\dot{x}_1 - \dot{x}_0)^2 + \qty(\dot{y}_1 - \dot{y}_0)^2 
        + \qty(x_1 - x_0) \qty(\ddot{x}_1 - \ddot{x}_0) + \qty(y_1 - y_0) \qty(\ddot{y}_1 - \ddot{y}_0)= 0
        \label{2d_single_cons_dd}
\end{align}
この\eqref{2d_single_cons_dd}に\eqref{2d_single_eom}を代入して$\lambda(t)/m$について解くと
\begin{align}
    0 &= \qty(\dot{x}_1 - \dot{x}_0)^2 + \qty(\dot{y}_1 - \dot{y}_0)^2
        + \qty(x_1 - x_0)\qty(-2\frac{\lambda}{m}\qty(x_1 - x_0) - \ddot{x}_0)
        + \qty(y_1 - y_0)\qty(-2\frac{\lambda}{m}\qty(y_1 - y_0) - g - \ddot{y}_0) \nonumber \\
    &= \qty(\dot{x}_1 - \dot{x}_0)^2 + \qty(\dot{y}_1 - \dot{y}_0)^2
        -2 l^2 \frac{\lambda}{m}
        - \qty(x_1 - x_0) \ddot{x}_0
        - \qty(y_1 - y_0)\qty(g + \ddot{y}_0) \nonumber \\
    \rightarrow&
    \frac{\lambda}{m} = \frac{1}{2 l^2} \qty(
        \qty(\dot{x}_1 - \dot{x}_0)^2 + \qty(\dot{y}_1 - \dot{y}_0)^2
        - \qty(x_1 - x_0) \ddot{x}_0 - \qty(y_1 - y_0)\qty(g + \ddot{y}_0)
    ) \label{2d_single_lambda}
\end{align}
途中で剛体棒長さの拘束条件\eqref{2d_single_cons}がそのまま出てくるので$l^2$に置き換えられるのがミソですね。
あとはこの\eqref{2d_single_lambda}を\eqref{2d_single_eom}に代入して普通に運動方程式を解けばいいはず。

一般の場合を考える前に特殊な場合を考えておく。
\eqref{2d_single_lambda}で$x_0(t)=y_0(t)=0$の場合を考える、つまりは普通のなんの変哲もない振り子ということ。
\eqref{2d_single_lambda}より
\begin{align}
    \frac{\lambda}{m} = \frac{1}{2 l^2} \qty(\dot{x}_1^2 + \dot{y}_1^2 - y_1 g)
\end{align}
\eqref{2d_single_eom}に代入して
\begin{align}
\begin{cases}
    \ddot{x}_1 = -\frac{1}{l^2} \qty(\dot{x}_1^2 + \dot{y}_1^2 - y_1 g) x_1 \\
    \ddot{y}_1 = -\frac{1}{l^2} \qty(\dot{x}_1^2 + \dot{y}_1^2 - y_1 g) y_1 - g
\end{cases}
\end{align}
となる。
あとでこれを直接解いてみるが、一旦検算のために$x_1(t)=l\cos{\theta(t)}, y_1(t)=l\sin{\theta(t)}$を代入してみる
（これは$x$軸から反時計回りに$\theta$をとっている、つまり普通の偏角）。

$\ddot{x}_1$についての式より
\begin{align}
    0 &= l\dv[2]{\qty(\cos\theta(t))}{t}
        + \frac{1}{l^2} \qty(
            \qty(l\dv{\qty(\cos\theta(t))}{t})^2 + \qty(l\dv{\qty(\sin\theta(t))}{t})^2
            - l\sin{\theta(t)} g
        ) l\cos{\theta(t)} \nonumber \\
    &= -\dv{}{t}\qty(\dot{\theta}\sin\theta) + \qty(\dot{\theta}^2 - \frac{g}{l}\sin\theta) \cos\theta \nonumber \\
    &= -\ddot{\theta}\sin\theta - \dot{\theta}^2\cos\theta + \qty(\dot{\theta}^2 - \frac{g}{l}\sin\theta) \cos\theta \nonumber \\
    \rightarrow&
    \ddot{\theta} = -\frac{g}{l}\cos\theta
\end{align}
$\ddot{y}_1$についての式も同様に変形できる。
あってそうですね。

\section{多次元多重振り子をラグランジュ未定乗数法で解く}

$N$個の質点が伸び縮みしない剛体棒で繋がれている状況を考える。
根本の座標が$\va{x}_0(t)$、根本から$i$番目の質点の質量$m_i$座標$\va{x}_i(t)$とする。
$0$番目が根本である。

今回は問題設定として、任意の$i$で座標を given にできるとする。
つまり多重振り子の任意の箇所を手で持って操作できるような状況を考える。
操作対象の点(根本の点を含むので質点とは言わない)のインデックスの集合を$C$としておく。

重力加速度を$\va{g}$とする。
このベクトルになった重力加速度は、例えば1章の2次元振り子の例だと$\va{g} = (0, g)$と解釈すれば良い。
重力の向きと重力加速度の向きがマイナス符号になってしまっているな。

これから何度も出てくるので以下の略記を利用する。
\begin{align}
    \va{x}_{i-1,i} = \va{x}_i - \va{x}_{i-1}
\end{align}

剛体棒による拘束条件を定式化すると
\begin{align}
    \abs{\va{x}_{i-1,i}}^2 = l_i^2 \label{nd_mult_cons}
\end{align}
となる。

拘束条件込みのラグランジアンと運動方程式は
\begin{align}
    L &= \sum_{i=1}^N \qty(
        \frac{1}{2} m_i \abs{\dot{\va{x}}_i}^2
        - m_i \va{g} \vdot \va{x}_i
        - \lambda_i \qty(\abs{\va{x}_{i-1,i}}^2 - l_i^2)
    ) \\
    m_i \ddot{\va{x}}_i &= -m_i \va{g} - 2\lambda_i \va{x}_{i-1,i}
\end{align}
となる。

\eqref{nd_mult_cons}を時間で微分する
\begin{align}
    & \abs{\va{x}_{i-1,i}}^2 = l_i^2 \tag{\ref{nd_mult_cons}} \\
    \xrightarrow{\dv[2]{}{t}} &
    \abs{\dot{\va{x}}_{i-1,i}}^2 + \va{x}_{i-1,i} \vdot \ddot{\va{x}}_{i-1,i} = 0
\end{align}
これを使って$\lambda_i/m_i$について解く。
まずは$i, i-1 \notin C$の場合
\begin{align}
    \abs{\dot{\va{x}}_{i-1,i}}^2 - \va{x}_{i-1,i} \vdot \qty(2\frac{\lambda_i}{m_i} \va{x}_i - 2\frac{\lambda_{i-1}}{m_{i-1}} \va{x}_{i-1}) = 0
\end{align}
次に$i \notin C, i-1 \in C$の場合
\begin{align}
    \abs{\dot{\va{x}}_{i-1,i}}^2 - \va{x}_{i-1,i} \vdot \qty(\va{g} + 2\frac{\lambda_i}{m_i} \va{x}_i + \ddot{\va{x}}_{i-1}) = 0
\end{align}
最後に$i \in C, i-1 \notin C$の場合
\begin{align}
    \abs{\dot{\va{x}}_{i-1,i}}^2 - \va{x}_{i-1,i} \vdot \qty(-\ddot{\va{x}}_i - \va{g} - 2\frac{\lambda_{i-1}}{m_{i-1}} \va{x}_{i-1}) = 0
\end{align}
これらを連立すれば解けるはず。

$\lambda_i/m_i$についてただの2段の対角行列（というのか知らないけど）。
運動方程式も同様。
なので数値的にやるなら$\lambda_i/m_i$については解析的に解かずそのまま数値的に線型方程式を2回解くのが良さそう。

\bibliographystyle{plain}
\bibliography{main.bib}
\end{document}
